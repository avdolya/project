<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>web</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
<script src="https://unpkg.com/htmx.org@1.9.6/dist/ext/json-enc.js"></script>
</head>
<body>


<!-- –ö–û–ù–¢–ï–ô–ù–ï–† –ü–û–ò–°–ö–ê -->
    <div class="search-container">
        <img src="/static/img/logo.png" alt="logo" width="35" height="35">
        <!-- –º–µ—Ç–æ–¥ get –Ω—É–∂–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ—Å —Å—Ç–æ—Ä–æ–Ω—ã –±—ç–∫–∞  -->
        <form action="/search" method="get" class="search-form">
            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." name="q" class="search-input">
            <button type="submit" class="search-button">–ù–∞–π—Ç–∏</button>
        </form>
    </div>


    <div class="wrapper">
    <header class="container">
        <nav>
            <ul>
                <li class="active"><a href="#">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="#">–ü—Ä–æ–≥—É–ª–∫–∏</a></li>
                <li><a href="#">–¢–µ–∞—Ç—Ä—ã</a></li>
                <li><a href="#">–ú—É–∑–µ–∏</a></li>
                <li><a href="#">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</a></li>
                <li><a href="#">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</a></li>
                <li><a href="#">–ú–æ–∏ –º–µ—Å—Ç–∞</a></li>
                <!-- –∞–π–¥–∏—à–Ω–∏–∫ –¥–ª—è js -->
                <li class="btn"><a href="#" id="authButton">–í–æ–π—Ç–∏</a></li>
            </ul>
        </nav>
    </header>
         <!-- –æ–¥–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>

    <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–æ—Ä–º -->
    <div id="authForms">
      <!-- —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π) -->
      <div id="loginForm">
        <h2>–í—Ö–æ–¥</h2>
          <!-- hx-post="/jwt/login/"  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
           –º–µ—Ç–æ–¥–æ–º POST –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É URL (/jwt/login/). hx-target="#authResponse" - —É–∫–∞–∑—ã–≤–∞–µ—Ç
            –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–±–ª–æ–∫ –¥–ª—è –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–æ–∫)
            hx-swap="innerHTML" –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫ –≤—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç (#authResponse).
            innerHTML (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ü–µ–ª–∏.-->
        <form
                hx-post="/jwt/login/"
                hx-target="#authResponse"
                hx-swap="innerHTML">
          <div>
            <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" id="username" name="username" required>
          </div>
          <div>
            <label for="password">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" name="password" required>
          </div>
          <button type="submit" class="search-button">–í–æ–π—Ç–∏</button>
        </form>
        <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="showRegister">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
      </div>

      <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
      <div id="registerForm" style="display:none">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <form

                hx-post="/users/"
                hx-target="#authResponse"
                hx-ext="json-enc"
        >
          <div>
            <label for="regUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" id="regUsername" name="username" required>
          </div>
          <div>
            <label for="regEmail">Email</label>
            <input type="email" id="regEmail" name="email" required>
          </div>
          <div>
            <label for="regPassword">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="regPassword" name="password" required>
          </div>
          <button type="submit" class="search-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–í–æ–π—Ç–∏</a></p>
      </div>
    </div>

    <!-- –ë–ª–æ–∫ –¥–ª—è –æ—à–∏–±–æ–∫ -->
    <div id="authResponse" class="notification"></div>
  </div>
</div>
    <div class="hero-info">
        <img style="float:right;padding: 40px 75px;" src="/static/img/1.jpeg" alt="–§–æ—Ç–æ" width="650" height="450">
        <div class="info">
            <h3>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É –¥–æ—Å—É–≥—É</h3>
            <h1>–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–µ –≥—Ä–∞–Ω–∏ —Å–≤–æ–µ–≥–æ –¥–æ—Å—É–≥–∞!</h1>
            <p style="padding-top:10px;">–ú—ã –Ω–∞–π–¥—ë–º –¥–ª—è –≤–∞—Å —Å–∞–º—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –∏ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è.</p>
            <h2 style="padding-top:10px;">–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
            <section class="categories">
                <ul>
                  <li style="padding-top:10px;">üé≠ –ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ</li>
                  <li style="padding-top:10px;">üçΩÔ∏è –ì–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è</li>
                  <li style="padding-top:10px;">üå≥ –ü—Ä–∏—Ä–æ–¥–∞</li>
                </ul>
            </section>
        </div>
    </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const authButton = document.getElementById('authButton');
        const authModal = document.getElementById('authModal');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const closeBtn = document.querySelector('.close');
        const authResponse = document.getElementById('authResponse');
        const passwordInput = document.getElementById('regPassword');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, isSuccess) {
            authResponse.innerHTML = `
                <div class="notification ${isSuccess ? 'success' : 'error'}">
                    ${message}
                </div>
            `;
            setTimeout(() => authResponse.innerHTML = '', 5000);
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
        passwordInput?.addEventListener('input', function() {
            if (this.value.length > 0 && this.value.length < 8) {
                this.setCustomValidity('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤');
            } else {
                this.setCustomValidity('');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        authButton.addEventListener('click', function(e) {
            e.preventDefault();
            authModal.style.display = 'block';
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            authResponse.innerHTML = '';
        });

        document.getElementById('showRegister')?.addEventListener('click', function(e) {
            e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            authResponse.innerHTML = '';
        });

        document.getElementById('showLogin')?.addEventListener('click', function(e) {
            e.preventDefault();
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            authResponse.innerHTML = '';
        });

        closeBtn.addEventListener('click', () => authModal.style.display = 'none');
        window.addEventListener('click', (e) => e.target === authModal && (authModal.style.display = 'none'));

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ HTMX-–∑–∞–ø—Ä–æ—Å–æ–≤
        document.body.addEventListener('htmx:afterRequest', function(e) {
            if (e.detail.successful) {
                if (e.detail.requestConfig.path === "/jwt/login/") {
                    authModal.style.display = 'none';
                    authButton.textContent = '–ü—Ä–æ—Ñ–∏–ª—å';
                    showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', true);
                }

                if (e.detail.requestConfig.path === "/users/") {
                    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                    loginForm.style.display = 'block';
                    registerForm.style.display = 'none';
                }
            } else {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                try {
                    const error = JSON.parse(e.detail.xhr.responseText);
                    let errorMessage = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞';

                    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                    if (error.detail) {
                        if (Array.isArray(error.detail)) {
                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Pydantic
                            errorMessage = error.detail.map(err =>
                                `${err.loc ? err.loc.join('.') + ': ' : ''}${err.msg}`
                            ).join('<br>');
                        } else if (typeof error.detail === 'string') {
                            errorMessage = error.detail;
                        } else if (error.detail.msg) {
                            errorMessage = error.detail.msg;
                        }
                    }

                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –ø–∞—Ä–æ–ª—è
                    if (errorMessage.includes('password') || errorMessage.includes('–ø–∞—Ä–æ–ª—å')) {
                        passwordInput?.focus();
                    }

                    showNotification(errorMessage, false);
                } catch {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', false);
                }
            }
        });
    });
</script>
</body>
</html>